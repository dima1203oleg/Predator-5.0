# –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ GKE Autopilot

–¶–µ–π –ø–æ—Å—ñ–±–Ω–∏–∫ –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ Google Kubernetes Engine –≤ —Ä–µ–∂–∏–º—ñ Autopilot.

## üìö –ó–º—ñ—Å—Ç

- [–ü–µ—Ä–µ–¥—É–º–æ–≤–∏](#–ø–µ—Ä–µ–¥—É–º–æ–≤–∏)
- [–®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç](#—à–≤–∏–¥–∫–∏–π-—Å—Ç–∞—Ä—Ç)
- [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å–∏—Å—Ç–µ–º–∏](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏-—Å–∏—Å—Ç–µ–º–∏)
- [–î–æ—Å—Ç—É–ø –¥–æ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤](#–¥–æ—Å—Ç—É–ø-–¥–æ-–≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤)
- [–†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤](#—Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è-–∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤)
- [–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥)
- [–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö](#–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è-–¥–∞–Ω–∏—Ö)
- [–ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è](#–º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è)
- [–û–±–º–µ–∂–µ–Ω–Ω—è –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è](#–æ–±–º–µ–∂–µ–Ω–Ω—è-–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ–≥–æ-—Ä—ñ–≤–Ω—è)
- [–ü–æ—à–∏—Ä–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏](#–ø–æ—à–∏—Ä–µ–Ω—ñ-–ø—Ä–æ–±–ª–µ–º–∏)

## üìã –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

1. –ê–∫–∞—É–Ω—Ç Google Cloud (–º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ)
2. –ê–∫—Ç–∏–≤–æ–≤–∞–Ω–∞ –ø–ª–∞—Ç—ñ–∂–Ω–∞ –∫–∞—Ä—Ç–∫–∞ (–¥–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó, –≥—Ä–æ—à—ñ –Ω–µ —Å–ø–∏—Å—É—é—Ç—å—Å—è –≤ —Ä–∞–º–∫–∞—Ö Free Tier)
3. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π Google Cloud SDK
4. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π kubectl

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤—Å—å–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤–∏–∫–æ–Ω–∞–π—Ç–µ:

```bash
# –ó—Ä–æ–±—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º
chmod +x gke-autopilot-setup.sh

# –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç
./gke-autopilot-setup.sh
```

–°–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω–∞—î:
1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É –≤ Google Cloud
2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä–∞ GKE Autopilot
3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Nginx Ingress
4. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è ArgoCD
5. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Prometheus —ñ Grafana
6. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Persistent Storage
7. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Horizontal Pod Autoscaler

### –†—É—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –≤—Ä—É—á–Ω—É:

#### 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä–∞ GKE Autopilot

```bash
gcloud container clusters create-auto predator-cluster \
    --region us-central1 \
    --project your-project-id
```

#### 2. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

```bash
gcloud container clusters get-credentials predator-cluster \
    --region us-central1 \
    --project your-project-id
```

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å–∏—Å—Ç–µ–º–∏

–ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —É –≤–∞—Å –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–æ:

- **GKE Autopilot –∫–ª–∞—Å—Ç–µ—Ä** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–µ—Ä–æ–≤–∞–Ω–∏–π Kubernetes –∫–ª–∞—Å—Ç–µ—Ä
- **ArgoCD** - GitOps —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
- **Nginx Ingress** - –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó HTTP-—Ç—Ä–∞—Ñ—ñ–∫—É
- **Prometheus** - —Å–∏—Å—Ç–µ–º–∞ –∑–±–æ—Ä—É –º–µ—Ç—Ä–∏–∫
- **Grafana** - —Å–∏—Å—Ç–µ–º–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó –º–µ—Ç—Ä–∏–∫
- **Persistent Storage** - –ø–æ—Å—Ç—ñ–π–Ω–µ —Å—Ö–æ–≤–∏—â–µ –¥–ª—è –¥–∞–Ω–∏—Ö
- **HPA** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–≤

## üåê –î–æ—Å—Ç—É–ø –¥–æ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤

### ArgoCD

```bash
# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ—Ä—Ç—É
kubectl port-forward svc/argocd-server -n argocd 8080:443

# –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è (—è–∫—â–æ –≤–∏ –Ω–µ –∑–±–µ—Ä–µ–≥–ª–∏ –π–æ–≥–æ –ø—ñ–¥ —á–∞—Å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è)
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
```

–í—ñ–¥–∫—Ä–∏–π—Ç–µ —É –±—Ä–∞—É–∑–µ—Ä—ñ: https://localhost:8080 (–ª–æ–≥—ñ–Ω: admin)

### Grafana

```bash
# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ—Ä—Ç—É
kubectl port-forward svc/prometheus-grafana -n monitoring 3000:80

# –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è (—è–∫—â–æ –≤–∏ –Ω–µ –∑–±–µ—Ä–µ–≥–ª–∏ –π–æ–≥–æ –ø—ñ–¥ —á–∞—Å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è)
kubectl get secret -n monitoring prometheus-grafana -o jsonpath="{.data.admin-password}" | base64 --decode
```

–í—ñ–¥–∫—Ä–∏–π—Ç–µ —É –±—Ä–∞—É–∑–µ—Ä—ñ: http://localhost:3000 (–ª–æ–≥—ñ–Ω: admin)

## üì¶ –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤

### –ß–µ—Ä–µ–∑ kubectl

```bash
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml
kubectl apply -f ingress.yaml
```

### –ß–µ—Ä–µ–∑ ArgoCD

1. –£–≤—ñ–π–¥—ñ—Ç—å —É –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å ArgoCD
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "NEW APP"
3. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É:
   - Application Name: my-app
   - Project: default
   - Repository URL: URL –≤–∞—à–æ–≥–æ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
   - Path: —à–ª—è—Ö –¥–æ –º–∞–Ω—ñ—Ñ–µ—Å—Ç—ñ–≤ K8s –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó
   - Cluster: https://kubernetes.default.svc (–¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞)
   - Namespace: predator (–∞–±–æ –≤–∞—à namespace)
4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "CREATE"

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

–ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–∏ –º–∞—î—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —á–µ—Ä–µ–∑ Grafana:

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Grafana (–¥–∏–≤. —Ä–æ–∑–¥—ñ–ª "–î–æ—Å—Ç—É–ø –¥–æ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤")
2. –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –≥–æ—Ç–æ–≤—ñ –¥–∞—à–±–æ—Ä–¥–∏ –¥–ª—è:
   - Kubernetes Cluster
   - Kubernetes Pods
   - Kubernetes Nodes
   - Prometheus

## üíæ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

–î–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Persistent Volume Claims:

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-data
  namespace: predator
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
```

–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è PVC —É –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—ñ:

```yaml
volumes:
- name: data-volume
  persistentVolumeClaim:
    claimName: my-data
containers:
- name: app
  volumeMounts:
  - mountPath: "/data"
    name: data-volume
```

## ‚öñÔ∏è –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è

–°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ HPA:

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: my-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: my-app
  minReplicas: 2
  maxReplicas: 5
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 50
```

## ‚ö†Ô∏è –û–±–º–µ–∂–µ–Ω–Ω—è –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è

GKE Autopilot Free Tier –º–∞—î —Ç–∞–∫—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è:
- 2 vCPU
- 1 GB RAM
- 30 GB –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É
- 1 –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –±–∞–ª–∞–Ω—Å—É–≤–∞–ª—å–Ω–∏–∫ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

–ü—ñ—Å–ª—è –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è —Ü–∏—Ö –ª—ñ–º—ñ—Ç—ñ–≤ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è —Ç–∞—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è.

## üîß –ü–æ—à–∏—Ä–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

### –ü–æ–º–∏–ª–∫–∞ "Quota exceeded"

–ú–æ–∂–ª–∏–≤–µ —Ä—ñ—à–µ–Ω–Ω—è: –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª—ñ–º—ñ—Ç–∏ –∫–≤–æ—Ç —É Google Cloud Console —ñ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –∑–∞–ø—Ä–æ—Å—ñ—Ç—å –∑–±—ñ–ª—å—à–µ–Ω–Ω—è.

### –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π Ingress

–ú–æ–∂–ª–∏–≤–µ —Ä—ñ—à–µ–Ω–Ω—è:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å Ingress: `kubectl get ingress -n predator`
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞: `kubectl logs -n ingress-nginx -l app.kubernetes.io/component=controller`

### –ù–µ–≤–¥–∞–ª–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è PVC

–ú–æ–∂–ª–∏–≤–µ —Ä—ñ—à–µ–Ω–Ω—è: 
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å PVC: `kubectl get pvc -n predator`
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ä–æ–∑–º—ñ—Ä PVC –Ω–µ –ø–µ—Ä–µ–≤–∏—â—É—î –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ 30 GB
```

–¶–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ Kubernetes, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è.
