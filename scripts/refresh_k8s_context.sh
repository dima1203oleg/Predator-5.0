#!/bin/bash
set -e

echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä—É —á–µ—Ä–µ–∑ kubectl..."

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–ª–∞—Å—Ç–µ—Ä
if ! kubectl cluster-info &> /dev/null; then
    echo "‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–ª–∞—Å—Ç–µ—Ä (connection refused)."
    echo "üîÑ –°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π –∫–ª–∞—Å—Ç–µ—Ä (Minikube)..."
    
    if command -v minikube &> /dev/null; then
        echo "üöÄ –ó–∞–ø—É—Å–∫ minikube..."
        minikube start
        kubectl config use-context minikube
    else
        echo "‚ùå Minikube –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω—ñ –¥–æ GKE –∞–±–æ —ñ–Ω—à–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞."
        exit 1
    fi
fi

echo "‚úÖ –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–ª–∞—Å—Ç–µ—Ä:"
kubectl cluster-info

echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—É–∑–ª—ñ–≤:"
kubectl get nodes

echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–¥—ñ–≤ —É –≤—Å—ñ—Ö –ø—Ä–æ—Å—Ç–æ—Ä–∞—Ö:"
kubectl get pods -A

# –í–∏–∫–ª–∏–∫–∞—î–º–æ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è Cloud Explorer —É VS Code (—è–∫—â–æ –≤–∞—à–∞ –≤–µ—Ä—Å—ñ—è VS Code –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ü–µ–π –≤–∏–∫–ª–∏–∫)
code --command "vscode-kubernetes-tools.refreshCloudExplorer" || echo "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è Cloud Explorer"

echo "‚úÖ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É Kubernetes –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –Ø–∫—â–æ –∫–ª–∞—Å—Ç–µ—Ä –≤—Å–µ —â–µ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å VS Code."
