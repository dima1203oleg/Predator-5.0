#!/bin/bash

echo "üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É –∑ Git..."

# –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ –∑–º—ñ–Ω–∏
if [ -n "$(git status --porcelain)" ]; then
    echo "üì¶ –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ –∑–º—ñ–Ω–∏..."
    git stash save "–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º"
fi

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–æ—Ç–æ—á–Ω—É –≥—ñ–ª–∫—É
current_branch=$(git branch --show-current)
echo "üìç –ü–æ—Ç–æ—á–Ω–∞ –≥—ñ–ª–∫–∞: $current_branch"

# –û—Ç—Ä–∏–º—É—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ –∑–º—ñ–Ω–∏
echo "‚¨áÔ∏è –û—Ç—Ä–∏–º—É—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ –∑–º—ñ–Ω–∏..."
git fetch origin

# –û–Ω–æ–≤–ª—é—î–º–æ main
echo "üîÑ –û–Ω–æ–≤–ª—é—î–º–æ main..."
git checkout main
git pull origin main

# –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—è –Ω–∞ —Ä–æ–±–æ—á—É –≥—ñ–ª–∫—É
if [ "$current_branch" != "main" ]; then
    echo "üîÑ –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—è –Ω–∞ –≥—ñ–ª–∫—É $current_branch..."
    git checkout $current_branch
    git merge main --no-ff
fi

# –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∑–º—ñ–Ω–∏
if [ -n "$(git stash list)" ]; then
    echo "üì¶ –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∑–º—ñ–Ω–∏..."
    git stash pop
fi

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å
echo "‚úÖ –°—Ç–∞—Ç—É—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é:"
git status

echo "üéâ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
